header:
  version: 10
  includes:
  - kas-local.yaml
machine: genericx86-64
distro: poky
target: mukube
repos:
  mukube:
    layers:
      meta-k8s-setup:
  poky:
    url: https://git.yoctoproject.org/git/poky
    refspec: hardknott
    layers:
      meta:
      meta-poky:
      meta-skeleton:
      meta-yocto-bsp:
  meta-openembedded:
    url: https://github.com/openembedded/meta-openembedded.git
    refspec: hardknott
    layers:
      meta-oe:  
      meta-filesystems:
      meta-python:
      meta-networking:
      meta-perl:
  meta-virtualization:
    url: https://git.yoctoproject.org/git/meta-virtualization
    refspec: hardknott 
  meta-security: 
    url: https://git.yoctoproject.org/cgit/cgit.cgi/meta-security/
    refspec: hardknott
  meta-selinux:
    url: https://git.yoctoproject.org/cgit/cgit.cgi/meta-selinux/
    refspec: hardknott
local_conf_header:
  meta-k8s-setup: |
    EXTRA_IMAGEDEPENDS += "ovmf qemu-system-native qemu-helper-native"
    EFI_PROVIDER = "systemd-boot"

    IMAGE_FSTYPES += "wic"
    IMAGE_CLASSES += "dm-verity-img"
    WKS_FILE = "mukube.wks.in"
    DM_VERITY_IMAGE ?= "mukube"
    DM_VERITY_IMAGE_TYPE = "ext4"
    INITRAMFS_IMAGE = "dm-verity-image-initramfs"
    INITRAMFS_FSTYPES = "cpio.gz"

    INHERIT += "extrausers"
    EXTRA_USERS_PARAMS = "usermod -P root root;"

    HOSTTOOLS = "docker"

bblayers_conf_header:
  meta-k8s-setup: |
    POKY_BBLAYERS_CONF_VERSION = "2"
    BBPATH = "${TOPDIR}"
    BBFILES ?= ""

    DISTRO_FEATURES += "systemd virtualization k8s ram aufs seccomp"
    DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
    VIRTUAL-RUNTIME_init_manager = "systemd"
    VIRTUAL-RUNTIME_initscripts = ""
